

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pinno.gui_web &mdash; PINNo Solver 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PINNo Solver
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pinno</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PINNo Solver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pinno.gui_web</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pinno.gui_web</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Interfaz web (Streamlit) para PINN Interactive Trainer.</span>

<span class="sd">Este m√≥dulo define la aplicaci√≥n web completa utilizando el framework Streamlit.</span>
<span class="sd">A diferencia de la versi√≥n de escritorio, esta aplicaci√≥n se ejecuta en el navegador</span>
<span class="sd">y se basa en un modelo de ejecuci√≥n reactivo (el script se re-ejecuta con cada interacci√≥n).</span>

<span class="sd">Caracter√≠sticas principales:</span>
<span class="sd">- **Path Patching**: Configuraci√≥n din√°mica de `sys.path` para permitir importaciones</span>
<span class="sd">  absolutas del paquete `pinno` sin necesidad de instalaci√≥n previa.</span>
<span class="sd">- **Gesti√≥n de Estado**: Uso de `st.session_state` para persistir el modelo y</span>
<span class="sd">  el historial de entrenamiento entre re-ejecuciones del script.</span>
<span class="sd">- **Visualizaci√≥n Reactiva**: Gr√°ficos que se actualizan en tiempo real durante</span>
<span class="sd">  el bucle de entrenamiento.</span>

<span class="sd">Usage:</span>
<span class="sd">    Para ejecutar esta aplicaci√≥n, utilice el comando:</span>
<span class="sd">    $ streamlit run src/gui_web.py</span>
<span class="sd">    </span>
<span class="sd">    O si est√° instalado como paquete:</span>
<span class="sd">    $ streamlit run path/to/site-packages/pinno/gui_web.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># --- CONFIGURACI√ìN DE ENTORNO E IMPORTACIONES ---</span>
<span class="c1"># ==============================================================================</span>

<span class="c1"># --- üõ†Ô∏è CORRECCI√ìN DE RUTAS (Path Patching) ---</span>
<span class="c1"># Streamlit ejecuta los scripts como archivos independientes, no como m√≥dulos.</span>
<span class="c1"># Esto rompe las importaciones relativas (from . import config).</span>
<span class="c1"># Soluci√≥n: Agregamos la carpeta ra√≠z del proyecto al PYTHONPATH din√°micamente.</span>

<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="c1"># Directorio actual (pinno/)</span>
<span class="n">root_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">current_dir</span><span class="p">)</span>                  <span class="c1"># Directorio padre (PINNo/)</span>

<span class="k">if</span> <span class="n">root_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">)</span>

<span class="c1"># --- IMPORTACIONES DEL N√öCLEO ---</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Intento 1: Importaci√≥n relativa (funciona si se lanza con python -m)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_active_config</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.training</span><span class="w"> </span><span class="kn">import</span> <span class="n">PINNTrainer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_model</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># Intento 2: Importaci√≥n absoluta (funciona con Path Patching o si est√° instalado)</span>
    <span class="c1"># Nota: Asumimos que la carpeta del paquete se llama &#39;pinno&#39; o &#39;src&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pinno.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_active_config</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pinno.training</span><span class="w"> </span><span class="kn">import</span> <span class="n">PINNTrainer</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pinno.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_model</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># Fallback para estructura antigua &#39;src&#39;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_active_config</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.training</span><span class="w"> </span><span class="kn">import</span> <span class="n">PINNTrainer</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_model</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># --- CONFIGURACI√ìN DE LA INTERFAZ DE USUARIO ---</span>
<span class="c1"># ==============================================================================</span>

<span class="n">st</span><span class="o">.</span><span class="n">set_page_config</span><span class="p">(</span>
    <span class="n">page_title</span><span class="o">=</span><span class="s2">&quot;PINNo - Interactive Trainer&quot;</span><span class="p">,</span>
    <span class="n">page_icon</span><span class="o">=</span><span class="s2">&quot;üß†&quot;</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;wide&quot;</span>
<span class="p">)</span>

<span class="c1"># CSS personalizado para mejorar la est√©tica de botones y m√©tricas</span>
<span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;style&gt;</span>
<span class="s2">    .stButton&gt;button {</span>
<span class="s2">        width: 100%;</span>
<span class="s2">        border-radius: 5px;</span>
<span class="s2">        height: 3em;</span>
<span class="s2">    }</span>
<span class="s2">    .metric-card {</span>
<span class="s2">        background-color: #f0f2f6;</span>
<span class="s2">        padding: 15px;</span>
<span class="s2">        border-radius: 10px;</span>
<span class="s2">        border-left: 5px solid #ff4b4b;</span>
<span class="s2">    }</span>
<span class="s2">    &lt;/style&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># --- GESTI√ìN DEL ESTADO (SESSION STATE) ---</span>
<span class="c1"># ==============================================================================</span>
<span class="c1"># Inicializamos variables que deben persistir entre recargas de p√°gina</span>

<span class="k">if</span> <span class="s1">&#39;trainer&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="s1">&#39;is_training&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="s1">&#39;training_history&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;epochs&quot;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">if</span> <span class="s1">&#39;external_data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">external_data</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="s1">&#39;current_problem&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_problem</span> <span class="o">=</span> <span class="s2">&quot;SHO&quot;</span>


<div class="viewcode-block" id="reset_training">
<a class="viewcode-back" href="../../pinno.html#pinno.gui_web.reset_training">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reset_training</span><span class="p">(</span><span class="n">problem_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reinicia el estado del entrenamiento para comenzar un nuevo experimento.</span>

<span class="sd">    Limpia el historial de p√©rdidas, detiene cualquier entrenamiento activo</span>
<span class="sd">    y reinicia la instancia del entrenador.</span>

<span class="sd">    Args:</span>
<span class="sd">        problem_name (str): Identificador del nuevo problema f√≠sico a resolver</span>
<span class="sd">                            (ej. &quot;SHO&quot;, &quot;HEAT&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;epochs&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_problem</span> <span class="o">=</span> <span class="n">problem_name</span></div>



<span class="c1"># ==============================================================================</span>
<span class="c1"># --- INTERFAZ PRINCIPAL ---</span>
<span class="c1"># ==============================================================================</span>

<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;üß† PINNo: Physics-Informed Neural Networks&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;### Plataforma Interactiva de Entrenamiento y Visualizaci√≥n&quot;</span><span class="p">)</span>

<span class="n">tab1</span><span class="p">,</span> <span class="n">tab2</span><span class="p">,</span> <span class="n">tab3</span><span class="p">,</span> <span class="n">tab4</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">([</span>
    <span class="s2">&quot;üìö Learn PINNs&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;üìÇ Data Explorer&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;‚öôÔ∏è Train &amp; Config&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;üìä Metrics Report&quot;</span>
<span class="p">])</span>

<span class="c1"># --- PESTA√ëA 1: EDUCACI√ìN ---</span>
<span class="k">with</span> <span class="n">tab1</span><span class="p">:</span>
    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;¬øQu√© es una PINN?&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Una **Red Neuronal Informada por la F√≠sica (PINN)** es un modelo de Deep Learning que no solo aprende de datos, </span>
<span class="s2">        sino que tambi√©n respeta las leyes de la f√≠sica descritas por Ecuaciones Diferenciales (EDP).</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">&quot;#### ¬øC√≥mo funciona?&quot;</span><span class="p">)</span>
        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        A diferencia de una red normal (&quot;Caja Negra&quot;), una PINN optimiza una funci√≥n de p√©rdida compuesta:</span>
<span class="s2">        $$ L_</span><span class="si">{total}</span><span class="s2"> = w_</span><span class="si">{data}</span><span class="s2"> \cdot L_</span><span class="si">{datos}</span><span class="s2"> + w_</span><span class="si">{physics}</span><span class="s2"> \cdot L_</span><span class="si">{f√≠sica}</span><span class="s2"> $$</span>
<span class="s2">        Donde $L_</span><span class="si">{f√≠sica}</span><span class="s2">$ es el **residual** de la ecuaci√≥n diferencial.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Conceptos Clave&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Epochs (√âpocas)&quot;</span><span class="p">):</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Cu√°ntas veces la red revisa el problema completo.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Learning Rate&quot;</span><span class="p">):</span>
            <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;El tama√±o del paso al corregir errores.&quot;</span><span class="p">)</span>

<span class="c1"># --- PESTA√ëA 2: EXPLORADOR DE DATOS ---</span>
<span class="k">with</span> <span class="n">tab2</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Carga de Datos Experimentales&quot;</span><span class="p">)</span>
    <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span><span class="s2">&quot;Arrastra tu archivo aqu√≠ (.csv / .xlsx)&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">uploaded_file</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uploaded_file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span>
            
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">external_data</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Archivo cargado: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> filas.&quot;</span><span class="p">)</span>
            
            <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">with</span> <span class="n">c1</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">c2</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error leyendo el archivo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- PESTA√ëA 3: ENTRENAMIENTO ---</span>
<span class="k">with</span> <span class="n">tab3</span><span class="p">:</span>
    <span class="n">col_config</span><span class="p">,</span> <span class="n">col_viz</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    
    <span class="k">with</span> <span class="n">col_config</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Configuraci√≥n&quot;</span><span class="p">)</span>
        <span class="n">problem</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Problema F√≠sico&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;SHO&quot;</span><span class="p">,</span> <span class="s2">&quot;DHO&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAT&quot;</span><span class="p">])</span>
        <span class="n">base_config</span> <span class="o">=</span> <span class="n">get_active_config</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;üß† Arquitectura&quot;</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">num_layers</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Capas&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;MODEL_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;num_layers&quot;</span><span class="p">])</span>
            <span class="n">hidden_dim</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Neuronas&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;MODEL_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">])</span>
            <span class="n">activation</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Activaci√≥n&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;tanh&quot;</span><span class="p">,</span> <span class="s2">&quot;relu&quot;</span><span class="p">,</span> <span class="s2">&quot;sigmoid&quot;</span><span class="p">,</span> <span class="s2">&quot;swish&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;‚öôÔ∏è Hiperpar√°metros&quot;</span><span class="p">):</span>
            <span class="n">lr</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Learning Rate&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;LEARNING_RATE&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.5f</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">epochs_target</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;EPOCHS&quot;</span><span class="p">])</span>
        
        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;‚öõÔ∏è F√≠sica&quot;</span><span class="p">):</span>
            <span class="n">phys_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="n">phys_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        
        <span class="n">start_btn</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;üöÄ Iniciar&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
        <span class="n">stop_btn</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;üõë Detener&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">start_btn</span><span class="p">:</span>
            <span class="n">reset_training</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
            <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;MODEL_CONFIG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;num_layers&quot;</span><span class="p">:</span> <span class="n">num_layers</span><span class="p">,</span> <span class="s2">&quot;hidden_dim&quot;</span><span class="p">:</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="s2">&quot;activation&quot;</span><span class="p">:</span> <span class="n">activation</span><span class="p">})</span>
            <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;LEARNING_RATE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span>
            <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;EPOCHS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epochs_target</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">phys_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="n">PINNTrainer</span><span class="p">(</span><span class="n">base_config</span><span class="p">,</span> <span class="n">problem</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">stop_btn</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">with</span> <span class="n">col_viz</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Monitor en Tiempo Real&quot;</span><span class="p">)</span>
        <span class="n">loss_chart</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
        <span class="n">solution_chart</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
        <span class="n">metric_box</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
            <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">trainer</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">trainer</span>
            
            <span class="k">while</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span> <span class="ow">and</span> <span class="n">trainer</span><span class="o">.</span><span class="n">epoch</span> <span class="o">&lt;</span> <span class="n">epochs_target</span><span class="p">:</span>
                <span class="n">current_loss</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span> 
                    <span class="n">losses</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">perform_one_step</span><span class="p">()</span>
                    <span class="n">current_loss</span> <span class="o">=</span> <span class="n">losses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_loss</span><span class="p">)</span>
                
                <span class="n">metric_box</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**Epoch:** </span><span class="si">{</span><span class="n">trainer</span><span class="o">.</span><span class="n">epoch</span><span class="si">}</span><span class="s2"> | **Loss:** </span><span class="si">{</span><span class="n">current_loss</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">progress_bar</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">epoch</span> <span class="o">/</span> <span class="n">epochs_target</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
                
                <span class="n">loss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Loss&quot;</span><span class="p">])</span>
                <span class="n">loss_chart</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="n">loss_df</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                
                <span class="c1"># --- VISUALIZACI√ìN ADAPTATIVA ---</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">problem</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SHO&quot;</span><span class="p">,</span> <span class="s2">&quot;DHO&quot;</span><span class="p">]:</span>
                    <span class="n">t_d</span> <span class="o">=</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;t_domain&quot;</span><span class="p">]</span>
                    <span class="n">t_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                    <span class="n">u_p</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">t_test</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                    <span class="n">u_t</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">analytical_solution</span><span class="p">(</span><span class="n">t_test</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_test</span><span class="p">,</span> <span class="n">u_t</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_test</span><span class="p">,</span> <span class="n">u_p</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PINN&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Din√°mica </span><span class="si">{</span><span class="n">problem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                    <span class="n">solution_chart</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">problem</span> <span class="o">==</span> <span class="s2">&quot;HEAT&quot;</span><span class="p">:</span>
                    <span class="n">N</span> <span class="o">=</span> <span class="mi">40</span> 
                    <span class="n">x_d</span> <span class="o">=</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;x_domain&quot;</span><span class="p">]</span>
                    <span class="n">y_d</span> <span class="o">=</span> <span class="n">base_config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;y_domain&quot;</span><span class="p">]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">t_mid</span> <span class="o">=</span> <span class="mf">0.5</span>
                    
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">t_mid</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
                    <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                    <span class="n">Z_true</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">analytical_solution</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                    
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Z_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z_pred</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Z_true</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Z_pred</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    
                    <span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z_pred</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicci√≥n t=</span><span class="si">{</span><span class="n">t_mid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z_true</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anal√≠tica t=</span><span class="si">{</span><span class="n">t_mid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
                    <span class="n">solution_chart</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span> <span class="k">break</span>

<span class="c1"># --- PESTA√ëA 4: REPORTES ---</span>
<span class="k">with</span> <span class="n">tab4</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Resultados y Exportaci√≥n&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No hay datos. Entrena un modelo primero.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">training_history</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
        <span class="n">trainer</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">trainer</span>
        <span class="n">problem</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">current_problem</span>

        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">c1</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s2">&quot;Loss Final&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">c2</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s2">&quot;Mejor Loss&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">c3</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s2">&quot;Problema&quot;</span><span class="p">,</span> <span class="n">problem</span><span class="p">)</span>
        
        <span class="n">st</span><span class="o">.</span><span class="n">divider</span><span class="p">()</span>
        <span class="n">col_graphs</span><span class="p">,</span> <span class="n">col_actions</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="k">with</span> <span class="n">col_graphs</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;üìà Convergencia&quot;</span><span class="p">)</span>
            <span class="n">fig_loss</span><span class="p">,</span> <span class="n">ax_loss</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">ax_loss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total Loss&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1f77b4&quot;</span><span class="p">)</span>
            <span class="n">ax_loss</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax_loss</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
            <span class="n">ax_loss</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
            <span class="n">ax_loss</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">fig_loss</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_loss</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">problem</span> <span class="o">==</span> <span class="s2">&quot;HEAT&quot;</span> <span class="ow">and</span> <span class="n">trainer</span><span class="p">:</span>
                <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;üî• Mapa de Calor Final&quot;</span><span class="p">)</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span> 
                <span class="n">x_d</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;x_domain&quot;</span><span class="p">]</span>
                <span class="n">y_d</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;PHYSICS_CONFIG&quot;</span><span class="p">][</span><span class="s2">&quot;y_domain&quot;</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">inp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mf">0.5</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
                <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">Z_true</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">analytical_solution</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
                
                <span class="n">fig_hm</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Z_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z_pred</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">Z_true</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Z_pred</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z_pred</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Predicci√≥n&quot;</span><span class="p">)</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z_true</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Anal√≠tica&quot;</span><span class="p">)</span>
                <span class="n">fig_hm</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
                <span class="n">st</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">fig_hm</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_hm</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">col_actions</span><span class="p">:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;üì• Exportar&quot;</span><span class="p">)</span>
            <span class="n">csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Loss&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span><span class="s2">&quot;üìÑ CSV Historial&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">csv</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;history.csv&quot;</span><span class="p">,</span> <span class="n">mime</span><span class="o">=</span><span class="s2">&quot;text/csv&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">trainer</span><span class="p">:</span>
                <span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;temp_model.keras&quot;</span>
                <span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span><span class="s2">&quot;üß† Modelo (.keras)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;pinn_model.keras&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Universidad Distrital Francisco Jos√© de Caldas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>